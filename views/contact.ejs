<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contact - PhishShield</title>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styleindex.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

 <%- include('./partials/nav') %>

<main class="main-content">
  <section class="contact-hero">
    <h1>ðŸ“ž Get in Touch</h1>
    <p>Have any questions, suggestions, or feedback? We'd love to hear from you!</p>
  </section>

  <section class="contact-form-section">
    <form id="contactForm">
      <input type="text" id="name" name="name" placeholder="Your Name" required />
      <input type="email" id="email" name="email" placeholder="Your Email" required />
      <input type="text" id="subject" name="subject" placeholder="Your Subject" required />
      <textarea id="message" name="message" placeholder="Your Message" rows="6" required></textarea>
      <button type="submit">Send Message</button>
  <div id="loadingSpinner" class="spinner" style="display: none;"></div>
</form>

    </section>
<div class="contact-InfoDiv" style="display: flex; justify-content: center; ">
   <section class="contact-info">
    <h2>ðŸ“§ Other Ways to Reach Us</h2>
    <p>Email: <a class="contact-link" href="mailto:anubhavsingh2027@gmail.com">anubhavsingh2027@gmail.com</a></p>
    <p>Whatsapp No: <a class="contact-link" href="https://api.whatsapp.com/send?phone=7355026966">7355026966</a></p>
  </section>
</div>

</main>

<%- include('./partials/footer') %>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // ===== helpers =====
  const SENDMAIL_URL = "https://anubhavmail.anubhavsingh.website/sendMail";
  const ADMIN_EMAIL = "anubhavsinghcustomer@gmail.com";

  // basic html-escape to avoid embedding raw user markup
  function escapeHtml(str = "") {
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  function createUserHtmlTemplate({ name, subject, message }) {
    const n = escapeHtml(name);
    const s = escapeHtml(subject);
    const m = escapeHtml(message).replace(/\n/g, "<br/>");
    return `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <style>
          body{font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:#f4f4f7;margin:0;padding:20px}
          .container{max-width:600px;margin:0 auto;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.08)}
          .header{background:#f8f9fa;padding:30px;text-align:center}
          .content{padding:28px;color:#333;line-height:1.6}
          .message-box{background:#f1f3f5;border-left:4px solid #007bff;padding:14px;margin-top:18px}
          .footer{background:#e9ecef;padding:18px;text-align:center;color:#6c757d;font-size:12px}
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header"><h2>PhishShield</h2></div>
          <div class="content">
            <h3>We've Received Your Feedback!</h3>
            <p>Hi ${n},</p>
            <p>Thank you for reaching out â€” we received the following message from you:</p>
            <div class="message-box">
              <p><strong>Subject:</strong> ${s}</p>
              <p>${m}</p>
            </div>
            <p>Our team will review it and get back to you if needed.</p>
            <p>Best regards,<br/><strong>The PhishShield Team</strong></p>
          </div>
          <div class="footer">&copy; ${new Date().getFullYear()} PhishShield â€” Developer: Anubhav Singh</div>
        </div>
      </body>
      </html>
    `;
  }

  // ===== auto-resize textarea =====
  const messageTextarea = document.getElementById("message");
  if (messageTextarea) {
    messageTextarea.addEventListener("input", function () {
      this.style.height = "auto";
      this.style.height = this.scrollHeight + "px";
    });
  }

  // ===== contact form logic =====
  const contactForm = document.getElementById("contactForm");
  const loadingSpinner = document.getElementById("loadingSpinner");

  if (!contactForm) return;

  contactForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = (document.getElementById("name") || {}).value?.trim() || "";
    const email = (document.getElementById("email") || {}).value?.trim() || "";
    const subject = (document.getElementById("subject") || {}).value?.trim() || "";
    const message = (document.getElementById("message") || {}).value?.trim() || "";

    if (!name || !email || !subject || !message) {
      alert("Please fill in all fields.");
      return;
    }

    // show spinner
    if (loadingSpinner) loadingSpinner.style.display = "block";

    try {
      // Admin payload (HTML message)
      const adminPayload = {
        to: ADMIN_EMAIL,
        subject: `New contact form submission: ${subject}`,
        websiteName: "PhishShield",
        message: `
          <h2>New contact form submission</h2>
          <p><strong>Name:</strong> ${escapeHtml(name)}</p>
          <p><strong>Email:</strong> ${escapeHtml(email)}</p>
          <p><strong>Subject:</strong> ${escapeHtml(subject)}</p>
          <p><strong>Message:</strong><br/>${escapeHtml(message).replace(/\n/g, "<br/>")}</p>
        `
      };

      // send admin notification
      const adminRes = await fetch(SENDMAIL_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(adminPayload)
      });

      let adminJson = null;
      try { adminJson = await adminRes.json(); } catch (e) { /* ignore parse error */ }

      if (!adminRes.ok || (adminJson && adminJson.success === false)) {
        console.error("Admin send failed:", adminRes.status, adminJson);
        alert("Failed to send message to admin. Please try again later.");
        return;
      }

      // Admin succeeded â€” send confirmation to user
      const userPayload = {
        to: email,
        subject: "Weâ€™ve Received Your Feedback | PhishShield",
        websiteName: "PhishShield",
        message: createUserHtmlTemplate({ name, subject, message })
      };

      const userRes = await fetch(SENDMAIL_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(userPayload)
      });

      let userJson = null;
      try { userJson = await userRes.json(); } catch (e) { /* ignore parse error */ }

      if (!userRes.ok || (userJson && userJson.success === false)) {
        console.warn("User confirmation send failed:", userRes.status, userJson);
        // still succeed overall because admin already got a message
        contactForm.reset();
        alert("Your message was sent to admin, but we couldn't send the confirmation email to you. Thank you!");
        return;
      }

      // everything ok
      contactForm.reset();
      alert("Message sent successfully. A confirmation email has been sent to your address. Thank you!");
    } catch (err) {
      console.error("Contact form error:", err);
      alert("An error occurred while sending your message. Please try again later.");
    } finally {
      if (loadingSpinner) loadingSpinner.style.display = "none";
    }
  });
});
</script>

</body>
</html>

